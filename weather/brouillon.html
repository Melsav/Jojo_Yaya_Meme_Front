
<script>// Fonction pour afficher les favoris de l'utilisateur et supprimer
function displayUserFavorites() {
    const token = localStorage.getItem('jwtToken');
    if (!token) {
        return; 
    }

    fetch(`${apiUrl}/favoris`, {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Réponse non valide du backend');
        }
        return response.json();
    })
    .then(data => {
        const userFavoritesList = document.getElementById('user-favorites-list');
        userFavoritesList.innerHTML = '';
        data.forEach(favorite => {
            const listItem = document.createElement('li');
            listItem.textContent = `${favorite.city}, ${favorite.country}`; 
            const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Supprimer';
                deleteButton.addEventListener('click', function() {
                    deleteFavorite(favorite);
                });
                listItem.appendChild(deleteButton);
            userFavoritesList.appendChild(listItem);
        });
    })
    .catch(error => {
        console.error('Erreur lors de la récupération des favoris de l\'utilisateur:', error);
        
    });
}

// Ajouter un favori lorsque l'utilisateur soumet le formulaire
document.getElementById('add-favorites-form').addEventListener('submit', function(event) {
    event.preventDefault(); // Empêche le formulaire de soumettre normalement
    const city = document.getElementById('favorite-city').value;
    const country = document.getElementById('favorite-country').value;
    addFavorite(city, country);
});


/* Fonction pour ajouter un favori
function addFavorite(cityName) {
    const token = localStorage.getItem('jwtToken');
    fetch(`${apiUrl}/addFavorite`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ cityName: cityName })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Favori ajouté avec succès', data);
        displayUserFavorites(); // Rafraîchir la liste des favoris après l'ajout réussi
    })
    .catch(error => console.error('Erreur lors de l\'ajout du favori:', error));
}*/

// Appel initial pour afficher les favoris de l'utilisateur au chargement de la page
displayUserFavorites();

function deleteFavorite(favorite) {
    fetch(`${apiUrl}/removeFavorite`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            userId: favorite.userId,
            city: favorite.city,
            country: favorite.country
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Erreur lors de la suppression du favori');
        }
        // Mettre à jour l'affichage des favoris après la suppression réussie
        displayUserFavorites();
    })
    .catch(error => console.error('Erreur lors de la suppression du favori:', error));
}

function addFavorite(city, country) {
   
    fetch(`${apiUrl}/addFavorite`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            city: city,
            country: country
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Erreur lors de l\'ajout du favori');
        }
        // Mettre à jour l'affichage des favoris après l'ajout réussi
        displayUserFavorites();
    })
    .catch(error => console.error('Erreur lors de l\'ajout du favori:', error));
}
